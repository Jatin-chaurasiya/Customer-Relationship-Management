<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Employee Management - Admin Panel</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
	<link rel="stylesheet" th:href="@{/css/admin-layout.css}" />
</head>

<body>
	<!-- Sidebar -->
	<div th:replace="~{fragments/admin-sidebar :: admin-sidebar}"></div>

	<!-- Main Content -->
	<div class="content">
		<div class="container-fluid">
			<!-- Header -->
			<div class="d-flex justify-content-between align-items-center mb-4">
				<div>
					<h2>Employee Management</h2>
					<p class="text-muted mb-0">Add, update and delete employees</p>
				</div>
				<a href="/addEmployee" class="btn btn-primary">
					<i class="bi bi-plus-circle"></i> Add Employee
				</a>
			</div>

			<!-- Success/Error Messages -->
			<div th:replace="~{fragments/SuccessandError :: SuccessandError}"></div>

			<!-- Employees Table Section -->
			<section class="mt-4">
				<div class="card shadow">
					<div class="card-body p-0">
						<!-- Empty state -->
						<div th:if="${employeePage.content.isEmpty()}" class="text-center py-5 px-3">
							<i class="bi bi-person-x" style="font-size: 4rem; color: #ccc;"></i>
							<h4 class="mt-3 text-muted">No employees found</h4>
							<p class="text-muted">Start by adding your first employee</p>
							<a href="/addEmployee" class="btn btn-primary mt-2">
								<i class="bi bi-plus-circle"></i> Add Employee
							</a>
						</div>

						<!-- Employees table -->
						<div th:if="${!employeePage.content.isEmpty()}">
							<div class="table-responsive">
								<table class="table table-striped table-hover table-bordered mb-0">
									<thead class="table-dark">
										<tr>
											<th scope="col">Name</th>
											<th scope="col">Email</th>
											<th scope="col">Phone No.</th>
											<th scope="col">City</th>
											<th scope="col" class="text-center">Actions</th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="employee : ${employeePage.content}">
											<td>
												<strong th:text="${employee.name}">Name</strong>
											</td>
											<td th:text="${employee.emailId}">Email</td>
											<td th:text="${employee.phoneNo != null && !employee.phoneNo.isEmpty() ? employee.phoneNo : '-'}">Phone</td>
											<td th:text="${employee.city != null && !employee.city.isEmpty() ? employee.city : '-'}">City</td>
											<td class="text-center">
												<div class="btn-group" role="group">
													<!-- Edit Button -->
													<a th:href="@{/editEmployee(employeeEmail=${employee.emailId})}" 
													   class="btn btn-sm btn-warning" 
													   title="Edit Employee">
														<i class="bi bi-pencil-fill text-white"></i>
													</a>
													<!-- Delete Button -->
													<button class="btn btn-sm btn-danger" 
													        th:data-eemail="${employee.emailId}"
													        onclick="confirmDelete(this.getAttribute('data-eemail'))"
													        title="Delete Employee">
														<i class="bi bi-trash-fill"></i>
													</button>
												</div>
											</td>
										</tr>
									</tbody>
								</table>
							</div>

							<!-- Pagination -->
							<div class="d-flex justify-content-center p-3 border-top">
								<div th:replace="~{fragments/paginationEmployee :: paginationEmployee(${employeePage})}"></div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>
	</div>

	<!-- Delete Confirmation Modal -->
	<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header bg-danger text-white">
					<h5 class="modal-title" id="deleteModalLabel">
						<i class="bi bi-exclamation-triangle-fill"></i> Confirm Delete
					</h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p>Are you sure you want to delete this employee?</p>
					<p><strong id="employeeEmailDisplay" class="text-danger"></strong></p>
					<p class="text-muted small">This action cannot be undone.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
						<i class="bi bi-x-circle"></i> Cancel
					</button>
					<button type="button" class="btn btn-danger" id="confirmDeleteBtn">
						<i class="bi bi-trash-fill"></i> Delete
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Loading Overlay -->
	<div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999;">
		<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
			<div class="spinner-border text-light" role="status" style="width: 3rem; height: 3rem;">
				<span class="visually-hidden">Loading...</span>
			</div>
			<p class="text-white mt-3">Deleting employee...</p>
		</div>
	</div>

	<!-- JavaScript -->
	<script>
		let employeeEmailToDelete = null;
		let deleteModal = null;

		document.addEventListener('DOMContentLoaded', function() {
			deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
		});

		function confirmDelete(email) {
			if (!email) {
				alert('Invalid employee email');
				return;
			}
			employeeEmailToDelete = email;
			document.getElementById('employeeEmailDisplay').textContent = email;
			deleteModal.show();
		}

		document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
			if (!employeeEmailToDelete) {
				alert('No employee selected');
				return;
			}
			document.getElementById('loadingOverlay').style.display = 'block';
			deleteModal.hide();
			window.location.href = '/deleteEmployeeDetails?employeeEmail=' + encodeURIComponent(employeeEmailToDelete);
		});

		// Auto-hide alerts after 5 seconds
		setTimeout(function() {
			const alerts = document.querySelectorAll('.alert');
			alerts.forEach(function(alert) {
				if (alert) {
					const bsAlert = new bootstrap.Alert(alert);
					bsAlert.close();
				}
			});
		}, 5000);
	</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>