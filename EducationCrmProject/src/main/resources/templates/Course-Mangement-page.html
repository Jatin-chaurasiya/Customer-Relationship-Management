<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Course Management - Admin Panel</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
	<link rel="stylesheet" th:href="@{/css/admin-layout.css}" />
	
</head>

<body>
	<div th:replace="~{fragments/admin-sidebar :: admin-sidebar}"></div>

	<div class="content">
		<div class="container-fluid">
			<div class="d-flex justify-content-between align-items-center mb-4">
				<div>
					<h2>Course Management</h2>
					<p class="text-muted mb-0">Add, update and delete courses</p>
				</div>
				<a href="/addCourse" class="btn btn-primary">
					<i class="bi bi-plus-circle"></i> Add Course
				</a>
			</div>

			<div th:replace="~{fragments/SuccessandError :: SuccessandError}"></div>

			<!-- Courses Table Section -->
			<section class="mt-4">
				<div class="card shadow">
					<div class="card-body p-0">
						<div th:if="${coursePage.content.isEmpty()}" class="text-center py-5 px-3">
							<i class="bi bi-folder-x" style="font-size: 4rem; color: #ccc;"></i>
							<h4 class="mt-3 text-muted">No courses found</h4>
							<p class="text-muted">Start by adding your first course</p>
							<a href="/addCourse" class="btn btn-primary mt-2">
								<i class="bi bi-plus-circle"></i> Add Course
							</a>
						</div>

						<div th:if="${!coursePage.content.isEmpty()}">
							<div class="table-responsive">
								<table class="table table-striped table-hover table-bordered mb-0">
									<thead class="table-dark">
										<tr>
											<th scope="col">Course Name</th>
											<th scope="col">Description</th>
											<th scope="col">Original Price</th>
											<th scope="col">Discounted Price</th>
											<th scope="col">Image</th>
											<th scope="col" class="text-center">Actions</th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="course : ${coursePage.content}">
											<td>
												<strong th:text="${course.name}">Course Name</strong>
											</td>
											<td>
												<span th:text="${course.description != null && !course.description.isEmpty() ? (course.description.length() > 50 ? course.description.substring(0, 50) + '...' : course.description) : 'No description'}">
													Description
												</span>
											</td>
											<td>
												<span th:if="${course.originalPrice != null && !course.originalPrice.isEmpty()}">
													<s class="text-muted" th:text="'₹' + ${course.originalPrice}">₹0</s>
												</span>
												<span th:unless="${course.originalPrice != null && !course.originalPrice.isEmpty()}">-</span>
											</td>
											<td>
												<strong class="text-success" th:text="${course.discountedPrice != null && !course.discountedPrice.isEmpty() ? '₹' + course.discountedPrice : '-'}">
													₹0
												</strong>
											</td>
											<td>
												<img th:if="${course.imageUrl != null && !course.imageUrl.isEmpty()}" 
												     th:src="@{${course.imageUrl}}" 
												     th:alt="${course.name + ' Image'}"
												     class="img-thumbnail"
												     width="100" 
												     height="60"
												     style="object-fit: cover;" />
												<span th:unless="${course.imageUrl != null && !course.imageUrl.isEmpty()}" 
												      class="text-muted">
													<i class="bi bi-image"></i> No Image
												</span>
											</td>
											<td class="text-center">
												<div class="btn-group" role="group">
													<a th:href="@{/editCourse(courseName=${course.name})}" 
													   class="btn btn-sm btn-warning" 
													   title="Edit Course">
														<i class="bi bi-pencil-fill text-white"></i>
													</a>
													<button class="btn btn-sm btn-danger" 
													        th:data-cname="${course.name}"
													        onclick="confirmDelete(this.getAttribute('data-cname'))"
													        title="Delete Course">
														<i class="bi bi-trash-fill"></i>
													</button>
												</div>
											</td>
										</tr>
									</tbody>
								</table>
							</div>

							<div class="d-flex justify-content-center p-3 border-top">
								<div th:replace="~{fragments/paginationCourse :: paginationCourse(${coursePage})}"></div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>
	</div>

	<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header bg-danger text-white">
					<h5 class="modal-title" id="deleteModalLabel">
						<i class="bi bi-exclamation-triangle-fill"></i> Confirm Delete
					</h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p>Are you sure you want to delete this course?</p>
					<p><strong id="courseNameDisplay" class="text-danger"></strong></p>
					<p class="text-muted small">This action cannot be undone.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
						<i class="bi bi-x-circle"></i> Cancel
					</button>
					<button type="button" class="btn btn-danger" id="confirmDeleteBtn">
						<i class="bi bi-trash-fill"></i> Delete
					</button>
				</div>
			</div>
		</div>
	</div>

	<div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999;">
		<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
			<div class="spinner-border text-light" role="status" style="width: 3rem; height: 3rem;">
				<span class="visually-hidden">Loading...</span>
			</div>
			<p class="text-white mt-3">Deleting course...</p>
		</div>
	</div>

	<!-- JavaScript -->
	<script>
		let courseNameToDelete = null;
		let deleteModal = null;

		document.addEventListener('DOMContentLoaded', function() {
			deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
		});

		function confirmDelete(courseName) {
			if (!courseName) {
				alert('Invalid course name');
				return;
			}
			courseNameToDelete = courseName;
			document.getElementById('courseNameDisplay').textContent = courseName;
			deleteModal.show();
		}

		document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
			if (!courseNameToDelete) {
				alert('No course selected');
				return;
			}
			document.getElementById('loadingOverlay').style.display = 'block';
			deleteModal.hide();
			window.location.href = '/deleteCourseDetails?courseName=' + encodeURIComponent(courseNameToDelete);
		});

		setTimeout(function() {
			const alerts = document.querySelectorAll('.alert');
			alerts.forEach(function(alert) {
				if (alert) {
					const bsAlert = new bootstrap.Alert(alert);
					bsAlert.close();
				}
			});
		}, 5000);
	</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>